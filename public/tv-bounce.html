<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TV Display</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; }
    iframe { width: 100vw; height: 100vh; border: none; }
    #countdown-bar {
      position: fixed; bottom: 0; left: 0;
      height: 4px; background: #0d6efd;
      z-index: 9999; width: 100%;
    }
    #loading {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: #fff; font-family: Arial, sans-serif;
      font-size: 1.2rem;
    }
    #manualControls {
      display: none;
      position: fixed; bottom: 20px; right: 20px; z-index: 9999;
    }
    #manualControls button {
      padding: 12px 20px; font-size: 1rem; border: none; color: white;
      font-weight: bold; cursor: pointer; border-radius: 50px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3); margin-left: 8px;
    }
    #btnBounceSwitch { background: #6f42c1; }
    #btnBounceStop { background: #dc3545; }
  </style>
</head>
<body>
  <div id="loading">Loading external page...</div>
  <iframe id="extFrame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-top-navigation"></iframe>
  <div id="countdown-bar"></div>
  <div id="manualControls">
    <button id="btnBounceSwitch">&#8592; Back to Tracker</button>
  </div>

  <script>
    var params = {};
    var hash = window.location.hash.substring(1);
    hash.split('&').forEach(function(part) {
      var eq = part.indexOf('=');
      if (eq > -1) {
        params[part.substring(0, eq)] = decodeURIComponent(part.substring(eq + 1));
      }
    });

    var extUrl = params.url || '';
    var duration = parseInt(params.duration) || 30;
    var returnUrl = params['return'] || '';
    var mode = params.mode || 'auto';

    if (extUrl) {
      var frame = document.getElementById('extFrame');
      frame.src = extUrl;
      frame.onload = function() {
        document.getElementById('loading').style.display = 'none';
      };
      setTimeout(function() {
        document.getElementById('loading').style.display = 'none';
      }, 3000);
    }

    if (mode === 'manual') {
      document.getElementById('countdown-bar').style.display = 'none';
      document.getElementById('manualControls').style.display = 'block';

      document.getElementById('btnBounceSwitch').onclick = function() {
        if (returnUrl) window.location.href = returnUrl;
      };
    } else {
      var bar = document.getElementById('countdown-bar');
      bar.style.transition = 'none';
      bar.style.width = '100%';
      bar.offsetHeight;
      bar.style.transition = 'width ' + duration + 's linear';
      bar.style.width = '0%';

      if (returnUrl) {
        setTimeout(function() {
          window.location.href = returnUrl;
        }, duration * 1000);
      }
    }
  </script>
</body>
</html>
