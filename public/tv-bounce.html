<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TV Display</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; }
    iframe { width: 100vw; height: 100vh; border: none; }
    #countdown-bar {
      position: fixed; bottom: 0; left: 0;
      height: 4px; background: #0d6efd;
      z-index: 9999; width: 100%;
    }
    #loading {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: #fff; font-family: Arial, sans-serif;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <div id="loading">Loading external page...</div>
  <iframe id="extFrame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-top-navigation"></iframe>
  <div id="countdown-bar"></div>

  <script>
    // Read parameters from URL hash
    // Format: tv-bounce.html#url=ENCODED_URL&duration=SECONDS&return=ENCODED_RETURN_URL
    var params = {};
    var hash = window.location.hash.substring(1);
    hash.split('&').forEach(function(part) {
      var eq = part.indexOf('=');
      if (eq > -1) {
        params[part.substring(0, eq)] = decodeURIComponent(part.substring(eq + 1));
      }
    });

    var extUrl = params.url || '';
    var duration = parseInt(params.duration) || 30;
    var returnUrl = params['return'] || '';

    if (extUrl) {
      var frame = document.getElementById('extFrame');
      frame.src = extUrl;
      frame.onload = function() {
        document.getElementById('loading').style.display = 'none';
      };
      // Hide loading after a timeout in case onload doesn't fire (cross-origin)
      setTimeout(function() {
        document.getElementById('loading').style.display = 'none';
      }, 3000);
    }

    // Countdown bar animation
    var bar = document.getElementById('countdown-bar');
    bar.style.transition = 'none';
    bar.style.width = '100%';
    bar.offsetHeight;
    bar.style.transition = 'width ' + duration + 's linear';
    bar.style.width = '0%';

    // Return to tracker after duration
    if (returnUrl) {
      setTimeout(function() {
        window.location.href = returnUrl;
      }, duration * 1000);
    }
  </script>
</body>
</html>
